(deftemplate hodnotenie
    (slot student)
    (slot predmet)
    (slot znamka)
)

(deffacts fakty
    (hodnotenie (student Jano)(predmet prog)(znamka FX))
    (hodnotenie (student Jano)(predmet uies)(znamka B))
    (hodnotenie (student Jano)(predmet siete)(znamka E))
    (hodnotenie (student Hana)(predmet prog)(znamka C))
    (hodnotenie (student Hana)(predmet uies)(znamka D))
    (hodnotenie (student Hana)(predmet siete)(znamka B))
)

;urobte pravidlo, ktore nacita od pouzivatela dalsich dvoch studedntov 
;(vid vyssie - ti ktori su vyssie ako nacitani studenti a vlozi do bazy faktov)

(defrule nacitaj_studenta_od_pouzivatela
  (not (nacitane))          
  =>
  (assert (nacitane))
  (loop-for-count 2

  (printout t "Zadaj meno studenta: ")
  (bind ?s1 (read))

  (printout t "Zadaj znamku z prog: ")
  (bind ?z1prog (read))

  (printout t "Zadaj znamku z uies: ")
  (bind ?z1uies (read))

  (printout t "Zadaj znamku zo siete: ")
  (bind ?z1siete (read))

  (assert (hodnotenie (student ?s1) (predmet prog)  (znamka ?z1prog)))
  (assert (hodnotenie (student ?s1) (predmet uies)  (znamka ?z1uies)))
  (assert (hodnotenie (student ?s1) (predmet siete) (znamka ?z1siete)))))

;urobte pravidlo alebo pravidla, ktore nam zmenia hodnotenie z A,B,C,D,E,FX 
;na ciselne hodnotenie 1;1,5;2;2,5;3;4 

(deftemplate hodnotenieCislom
    (slot student)
    (slot predmet)
    (slot znamka)
)

(deftemplate znamky
    (slot pismeno)
    (slot cislo)
)

(deffacts prevod
    (znamky (pismeno A) (cislo 1))
    (znamky (pismeno B) (cislo 1.5))
    (znamky (pismeno C) (cislo 2))
    (znamky (pismeno D) (cislo 2.5))
    (znamky (pismeno E) (cislo 3))
    (znamky (pismeno FX) (cislo 4))
)

(defrule zmena_hodnotenia
    (hodnotenie (student ?m)(predmet ?p)(znamka ?z))
    (not (hodnotenieCislom (student ?m)(predmet ?p)))
    (znamky (pismeno ?z) (cislo ?c))
=>
    (assert (hodnotenieCislom (student ?m)(predmet ?p)(znamka ?c)))
)

;urobte pravidlo alebo pravidla ktore nam spocita kolko mame studentov s FX
 
(deftemplate studentifx
  (multislot mena)
)

(deffacts data
  (studentifx (mena))
)

(defrule oznac
    (hodnotenie (student ?m) (znamka FX))
    ?s <- (studentifx (mena $?zoz))
    (test (not (member$ ?m $?zoz)))
  =>
    (modify ?s (mena $?zoz ?m))
)

(defrule pocetStudentov
    (declare (salience -10))
    (studentifx (mena $?zoz))
  =>
    (printout t "Pocet studentov s FX = " (length$ $?zoz) crlf)
)

(deftemplate priemer
  (slot student)
  (slot hodnota)
)

(defrule vypocitajpriemer
  (declare (salience -20))
  (hodnotenieCislom (student ?s))     
  (not (priemer (student ?s)))        
  =>
  (bind ?suma 0)
  (bind ?pocet 0)

  (do-for-all-facts ((?h hodnotenieCislom))
    (eq ?h:student ?s)
        (bind ?suma (+ ?suma ?h:znamka))
        (bind ?pocet (+ ?pocet 1))
  )

  (assert (priemer (student ?s) (hodnota (/ ?suma ?pocet))))
)

