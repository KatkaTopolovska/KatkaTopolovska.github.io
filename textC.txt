(deftemplate film
  (slot nazov (type STRING))
  (slot reziser (type STRING))
  (multislot herci (type SYMBOL) (default prazdne))
  (slot rozpocet (type INTEGER) (range 1000 50000) (default 1000))
  (slot rok (type INTEGER) (range 1965 2020))
  (slot pocet-hercov (type INTEGER) (default 0))
)

(deffacts filmy
  (film
    (nazov "Perinbaba")
    (reziser "Juraj Jakubisko")
    (herci Stefan_Kvietik Magda_Vasarova Zdena_Studenkova Jan_Kroner Vlado_Muller)
    (rozpocet 1000)
    (rok 1971))

  (film
    (nazov "Dracie diery")
    (reziser "Marek Tapak")
    (herci Emilia_Vasarova Jan_Kolenik Juraj_Kukura Vlado_Muller Sona_Valentova Mikulas_Huba)
    (rozpocet 49000)
    (rok 1975))

  (film
    (nazov "Panelak")
    (reziser "Stefan_Skrucany")
    (herci Juraj_Loj Jozo_Vajda Zuzana_Kocurikova Magda_Vasarova)
    (rozpocet 30000)
    (rok 2012))

  ; prázdny film
  (film
    (nazov "Prazdny film")
    (reziser "")
    (rok 2000))
)

;Načítanie 2 filmov od používateľa (jeden bez rozpočtu, druhý bez hercov)

(defrule nacitaj_filmy
  (not (nacitane))
  =>
  (assert (nacitane))
  (assert (pomoc))
  (printout t "Nazov filmu 1: ") (bind ?n1 (readline))
  (printout t "Reziser: ")       (bind ?r1 (readline))
  (printout t "Rok: ")           (bind ?rok1 (read))
  (printout t "Herci: ") (bind $?h1 (explode$ (readline)))

  (assert (film (nazov ?n1)(reziser ?r1)(herci $?h1)(rok ?rok1)))

  (printout t "Nazov filmu 2: ") (bind ?n2 (readline))
  (printout t "Reziser: ")       (bind ?r2 (readline))
  (printout t "Rozpocet: ")      (bind ?roz (read))
  (printout t "Rok: ")           (bind ?rok2 (read))

  (assert (film (nazov ?n2)(reziser ?r2)(rozpocet ?roz)(rok ?rok2)))
)

;Počet hercov v každom filme (uložiť do šablóny)

(defrule spocitaj-hercov
  ?f <- (film (nazov ?n)(herci $?h))
  (film (nazov ?n)(pocet-hercov 0))
  =>
  (modify ?f (pocet-hercov (length$ $?h)))
)

;Ak hrá Jozo Vajda → vlož ho do prázdneho filmu + režiséra

(defrule najdi-joza
  (film (nazov ?n) (reziser ?r) (herci $? Jozo_Vajda $?))
  ?p <- (film (nazov "Prazdny film") (herci prazdne))
  ?d <- (pomoc)
  =>
  (modify ?p (herci Jozo_Vajda)(reziser ?r))
  (retract ?d)
)

;Vytvor zoznam hercov a vlož do načítaného filmu

(defrule pridaj-hercov-do-filmu
  ?f <- (film (herci prazdne))
  (not (film (nazov "Prazdny film")))   
  =>
  (bind $?herci (create$ Marian_Labuda Milan_Lasica Maros_Kramar))
  (bind $?herecky (create$ Zuzana_Kronerova Zuzana_Fialova))
  (modify ?f (herci $?herci $?herecky))
)

;Priemerný rozpočet na film

(defrule priemer-rozpoctu
  (declare (salience -20))
  =>
  (bind ?suma 0)
  (bind ?pocet 0)

  (do-for-all-facts ((?f film))
    (neq ?f:rozpocet nil)
    (bind ?suma (+ ?suma ?f:rozpocet))
    (bind ?pocet (+ ?pocet 1))
  )

  (printout t "Priemerny rozpocet = " (/ ?suma ?pocet) crlf)
)
